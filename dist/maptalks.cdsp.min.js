/*!
 * maptalks.cdsp v0.1.0-alpha.1
 * LICENSE : MIT
 * (c) 2016-2018 maptalks.org
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.maptalks=t.maptalks||{})}(this,function(t){"use strict";var e=function(){this.__data__=[],this.size=0};var f=function(t,e){return t===e||t!=t&&e!=e};var n=function(t,e){for(var o=t.length;o--;)if(f(t[o][0],e))return o;return-1},r=Array.prototype.splice;var o=function(t){var e=this.__data__,o=n(e,t);return!(o<0||(o==e.length-1?e.pop():r.call(e,o,1),--this.size,0))};var i=function(t){var e=this.__data__,o=n(e,t);return o<0?void 0:e[o][1]};var a=function(t){return-1<n(this.__data__,t)};var s=function(t,e){var o=this.__data__,r=n(o,t);return r<0?(++this.size,o.push([t,e])):o[r][1]=e,this};function c(t){var e=-1,o=null==t?0:t.length;for(this.clear();++e<o;){var r=t[e];this.set(r[0],r[1])}}c.prototype.clear=e,c.prototype.delete=o,c.prototype.get=i,c.prototype.has=a,c.prototype.set=s;var u=c;var l=function(){this.__data__=new u,this.size=0};var p=function(t){var e=this.__data__,o=e.delete(t);return this.size=e.size,o};var y=function(t){return this.__data__.get(t)};var h=function(t){return this.__data__.has(t)},_="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function v(t,e){return t(e={exports:{}},e.exports),e.exports}var b="object"==("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(_)&&_&&_.Object===Object&&_,d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m="object"==("undefined"==typeof self?"undefined":d(self))&&self&&self.Object===Object&&self,g=b||m||Function("return this")(),j=g.Symbol,S=Object.prototype,w=S.hasOwnProperty,O=S.toString,k=j?j.toStringTag:void 0;var E=function(t){var e=w.call(t,k),o=t[k];try{var r=!(t[k]=void 0)}catch(t){}var n=O.call(t);return r&&(e?t[k]=o:delete t[k]),n},P=Object.prototype.toString;var G=function(t){return P.call(t)},A=j?j.toStringTag:void 0;var C=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":A&&A in Object(t)?E(t):G(t)},z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var M=function(t){var e=void 0===t?"undefined":z(t);return null!=t&&("object"==e||"function"==e)};var T,L=function(t){if(!M(t))return!1;var e=C(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},x=g["__core-js_shared__"],F=(T=/[^.]+$/.exec(x&&x.keys&&x.keys.IE_PROTO||""))?"Symbol(src)_1."+T:"";var I=function(t){return!!F&&F in t},R=Function.prototype.toString;var U=function(t){if(null!=t){try{return R.call(t)}catch(t){}try{return t+""}catch(t){}}return""},N=/^\[object .+?Constructor\]$/,D=Function.prototype,B=Object.prototype,W=D.toString,$=B.hasOwnProperty,Z=RegExp("^"+W.call($).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var V=function(t){return!(!M(t)||I(t))&&(L(t)?Z:N).test(U(t))};var q=function(t,e){return null==t?void 0:t[e]};var X=function(t,e){var o=q(t,e);return V(o)?o:void 0},Y=X(g,"Map"),H=X(Object,"create");var J=function(){this.__data__=H?H(null):{},this.size=0};var K=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Q=Object.prototype.hasOwnProperty;var tt=function(t){var e=this.__data__;if(H){var o=e[t];return"__lodash_hash_undefined__"===o?void 0:o}return Q.call(e,t)?e[t]:void 0},et=Object.prototype.hasOwnProperty;var ot=function(t){var e=this.__data__;return H?void 0!==e[t]:et.call(e,t)};var rt=function(t,e){var o=this.__data__;return this.size+=this.has(t)?0:1,o[t]=H&&void 0===e?"__lodash_hash_undefined__":e,this};function nt(t){var e=-1,o=null==t?0:t.length;for(this.clear();++e<o;){var r=t[e];this.set(r[0],r[1])}}nt.prototype.clear=J,nt.prototype.delete=K,nt.prototype.get=tt,nt.prototype.has=ot,nt.prototype.set=rt;var it=nt;var at=function(){this.size=0,this.__data__={hash:new it,map:new(Y||u),string:new it}},st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var ct=function(t){var e=void 0===t?"undefined":st(t);return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var ut=function(t,e){var o=t.__data__;return ct(e)?o["string"==typeof e?"string":"hash"]:o.map};var lt=function(t){var e=ut(this,t).delete(t);return this.size-=e?1:0,e};var ft=function(t){return ut(this,t).get(t)};var pt=function(t){return ut(this,t).has(t)};var yt=function(t,e){var o=ut(this,t),r=o.size;return o.set(t,e),this.size+=o.size==r?0:1,this};function ht(t){var e=-1,o=null==t?0:t.length;for(this.clear();++e<o;){var r=t[e];this.set(r[0],r[1])}}ht.prototype.clear=at,ht.prototype.delete=lt,ht.prototype.get=ft,ht.prototype.has=pt,ht.prototype.set=yt;var _t=ht;var vt=function(t,e){var o=this.__data__;if(o instanceof u){var r=o.__data__;if(!Y||r.length<199)return r.push([t,e]),this.size=++o.size,this;o=this.__data__=new _t(r)}return o.set(t,e),this.size=o.size,this};function bt(t){var e=this.__data__=new u(t);this.size=e.size}bt.prototype.clear=l,bt.prototype.delete=p,bt.prototype.get=y,bt.prototype.has=h,bt.prototype.set=vt;var dt=bt;var mt=function(t){return this.__data__.has(t)};function gt(t){var e=-1,o=null==t?0:t.length;for(this.__data__=new _t;++e<o;)this.add(t[e])}gt.prototype.add=gt.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},gt.prototype.has=mt;var jt=gt;var St=function(t,e){for(var o=-1,r=null==t?0:t.length;++o<r;)if(e(t[o],o,t))return!0;return!1};var wt=function(t,e){return t.has(e)};var Ot=function(t,e,o,r,n,i){var a=1&o,s=t.length,c=e.length;if(s!=c&&!(a&&s<c))return!1;var u=i.get(t);if(u&&i.get(e))return u==e;var l=-1,f=!0,p=2&o?new jt:void 0;for(i.set(t,e),i.set(e,t);++l<s;){var y=t[l],h=e[l];if(r)var _=a?r(h,y,l,e,t,i):r(y,h,l,t,e,i);if(void 0!==_){if(_)continue;f=!1;break}if(p){if(!St(e,function(t,e){if(!wt(p,e)&&(y===t||n(y,t,o,r,i)))return p.push(e)})){f=!1;break}}else if(y!==h&&!n(y,h,o,r,i)){f=!1;break}}return i.delete(t),i.delete(e),f},kt=g.Uint8Array;var Et=function(t){var o=-1,r=Array(t.size);return t.forEach(function(t,e){r[++o]=[e,t]}),r};var Pt=function(t){var e=-1,o=Array(t.size);return t.forEach(function(t){o[++e]=t}),o},Gt=j?j.prototype:void 0,At=Gt?Gt.valueOf:void 0;var Ct=function(t,e,o,r,n,i,a){switch(o){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!i(new kt(t),new kt(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return f(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var s=Et;case"[object Set]":var c=1&r;if(s||(s=Pt),t.size!=e.size&&!c)return!1;var u=a.get(t);if(u)return u==e;r|=2,a.set(t,e);var l=Ot(s(t),s(e),r,n,i,a);return a.delete(t),l;case"[object Symbol]":if(At)return At.call(t)==At.call(e)}return!1};var zt=function(t,e){for(var o=-1,r=e.length,n=t.length;++o<r;)t[n+o]=e[o];return t},Mt=Array.isArray;var Tt=function(t,e,o){var r=e(t);return Mt(t)?r:zt(r,o(t))};var Lt=function(t,e){for(var o=-1,r=null==t?0:t.length,n=0,i=[];++o<r;){var a=t[o];e(a,o,t)&&(i[n++]=a)}return i};var xt=function(){return[]},Ft=Object.prototype.propertyIsEnumerable,It=Object.getOwnPropertySymbols,Rt=It?function(e){return null==e?[]:(e=Object(e),Lt(It(e),function(t){return Ft.call(e,t)}))}:xt;var Ut=function(t,e){for(var o=-1,r=Array(t);++o<t;)r[o]=e(o);return r},Nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var Dt=function(t){return null!=t&&"object"==(void 0===t?"undefined":Nt(t))};var Bt=function(t){return Dt(t)&&"[object Arguments]"==C(t)},Wt=Object.prototype,$t=Wt.hasOwnProperty,Zt=Wt.propertyIsEnumerable,Vt=Bt(function(){return arguments}())?Bt:function(t){return Dt(t)&&$t.call(t,"callee")&&!Zt.call(t,"callee")};var qt=function(){return!1},Xt=v(function(t,e){var o=e&&!e.nodeType&&e,r=o&&t&&!t.nodeType&&t,n=r&&r.exports===o?g.Buffer:void 0,i=(n?n.isBuffer:void 0)||qt;t.exports=i}),Yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ht=/^(?:0|[1-9]\d*)$/;var Jt=function(t,e){var o=void 0===t?"undefined":Yt(t);return!!(e=null==e?9007199254740991:e)&&("number"==o||"symbol"!=o&&Ht.test(t))&&-1<t&&t%1==0&&t<e};var Kt=function(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=9007199254740991},Qt={};Qt["[object Float32Array]"]=Qt["[object Float64Array]"]=Qt["[object Int8Array]"]=Qt["[object Int16Array]"]=Qt["[object Int32Array]"]=Qt["[object Uint8Array]"]=Qt["[object Uint8ClampedArray]"]=Qt["[object Uint16Array]"]=Qt["[object Uint32Array]"]=!0,Qt["[object Arguments]"]=Qt["[object Array]"]=Qt["[object ArrayBuffer]"]=Qt["[object Boolean]"]=Qt["[object DataView]"]=Qt["[object Date]"]=Qt["[object Error]"]=Qt["[object Function]"]=Qt["[object Map]"]=Qt["[object Number]"]=Qt["[object Object]"]=Qt["[object RegExp]"]=Qt["[object Set]"]=Qt["[object String]"]=Qt["[object WeakMap]"]=!1;var te=function(t){return Dt(t)&&Kt(t.length)&&!!Qt[C(t)]};var ee=function(e){return function(t){return e(t)}},oe=v(function(t,e){var o=e&&!e.nodeType&&e,r=o&&t&&!t.nodeType&&t,n=r&&r.exports===o&&b.process,i=function(){try{var t=r&&r.require&&r.require("util").types;return t||n&&n.binding&&n.binding("util")}catch(t){}}();t.exports=i}),re=oe&&oe.isTypedArray,ne=re?ee(re):te,ie=Object.prototype.hasOwnProperty;var ae=function(t,e){var o=Mt(t),r=!o&&Vt(t),n=!o&&!r&&Xt(t),i=!o&&!r&&!n&&ne(t),a=o||r||n||i,s=a?Ut(t.length,String):[],c=s.length;for(var u in t)!e&&!ie.call(t,u)||a&&("length"==u||n&&("offset"==u||"parent"==u)||i&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Jt(u,c))||s.push(u);return s},se=Object.prototype;var ce=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||se)};var ue=function(e,o){return function(t){return e(o(t))}}(Object.keys,Object),le=Object.prototype.hasOwnProperty;var fe=function(t){if(!ce(t))return ue(t);var e=[];for(var o in Object(t))le.call(t,o)&&"constructor"!=o&&e.push(o);return e};var pe=function(t){return null!=t&&Kt(t.length)&&!L(t)};var ye=function(t){return pe(t)?ae(t):fe(t)};var he=function(t){return Tt(t,ye,Rt)},_e=Object.prototype.hasOwnProperty;var ve=function(t,e,o,r,n,i){var a=1&o,s=he(t),c=s.length;if(c!=he(e).length&&!a)return!1;for(var u=c;u--;){var l=s[u];if(!(a?l in e:_e.call(e,l)))return!1}var f=i.get(t);if(f&&i.get(e))return f==e;var p=!0;i.set(t,e),i.set(e,t);for(var y=a;++u<c;){var h=t[l=s[u]],_=e[l];if(r)var v=a?r(_,h,l,e,t,i):r(h,_,l,t,e,i);if(!(void 0===v?h===_||n(h,_,o,r,i):v)){p=!1;break}y||(y="constructor"==l)}if(p&&!y){var b=t.constructor,d=e.constructor;b!=d&&"constructor"in t&&"constructor"in e&&!("function"==typeof b&&b instanceof b&&"function"==typeof d&&d instanceof d)&&(p=!1)}return i.delete(t),i.delete(e),p},be=X(g,"DataView"),de=X(g,"Promise"),me=X(g,"Set"),ge=X(g,"WeakMap"),je="[object Map]",Se="[object Promise]",we="[object Set]",Oe="[object WeakMap]",ke="[object DataView]",Ee=U(be),Pe=U(Y),Ge=U(de),Ae=U(me),Ce=U(ge),ze=C;(be&&ze(new be(new ArrayBuffer(1)))!=ke||Y&&ze(new Y)!=je||de&&ze(de.resolve())!=Se||me&&ze(new me)!=we||ge&&ze(new ge)!=Oe)&&(ze=function(t){var e=C(t),o="[object Object]"==e?t.constructor:void 0,r=o?U(o):"";if(r)switch(r){case Ee:return ke;case Pe:return je;case Ge:return Se;case Ae:return we;case Ce:return Oe}return e});var Me=ze,Te="[object Arguments]",Le="[object Array]",xe="[object Object]",Fe=Object.prototype.hasOwnProperty;var Ie=function(t,e,o,r,n,i){var a=Mt(t),s=Mt(e),c=a?Le:Me(t),u=s?Le:Me(e),l=(c=c==Te?xe:c)==xe,f=(u=u==Te?xe:u)==xe,p=c==u;if(p&&Xt(t)){if(!Xt(e))return!1;l=!(a=!0)}if(p&&!l)return i||(i=new dt),a||ne(t)?Ot(t,e,o,r,n,i):Ct(t,e,c,o,r,n,i);if(!(1&o)){var y=l&&Fe.call(t,"__wrapped__"),h=f&&Fe.call(e,"__wrapped__");if(y||h){var _=y?t.value():t,v=h?e.value():e;return i||(i=new dt),n(_,v,o,r,i)}}return!!p&&(i||(i=new dt),ve(t,e,o,r,n,i))};var Re=function t(e,o,r,n,i){return e===o||(null==e||null==o||!Dt(e)&&!Dt(o)?e!=e&&o!=o:Ie(e,o,r,n,t,i))};var Ue=function(t,e){return Re(t,e)};function Ne(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var o=Object.getOwnPropertyNames(e),r=0;r<o.length;r++){var n=o[r],i=Object.getOwnPropertyDescriptor(e,n);i&&i.configurable&&void 0===t[n]&&Object.defineProperty(t,n,i)}}(t,e))}var De={enableCollection:!1,symbol:{markerFill:"#00bcd4",lineColor:"#00bcd4",lineWidth:4}},Be=function(o){function r(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,o.call(this,t));return e._updateSameType(),e._updateUpdateSymbol(),e._layerName=maptalks.INTERNAL_LAYER_PREFIX+"_CDSP",e._chooseGeos=[],e._hitSymbol={markerFill:"#ffa400",lineColor:"#ffa400",lineWidth:4},e}return Ne(r,o),r.prototype.setSymbol=function(t){return this._updateUpdateSymbol(t),this},r.prototype.enableCollection=function(t){return this._updateSameType(t),this},r.prototype.combine=function(t){return t instanceof maptalks.Geometry&&(this.geometry&&this.remove(),this._task="combine",this.geometry=t,this.layer=t._layer,t.type.startsWith("Multi")&&(this.layer=t._geometries[0]._layer),this._addTo(layer.map),this._chooseGeos=[t],this._updateChooseGeos()),this},r.prototype.submit=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){return!1};switch(this._task){case"combine":this._submitCombine(t)}this.remove()},r.prototype.cancel=function(){this.remove()},r.prototype.remove=function(){var t=this._map,e=t.getLayer(this._layerName);e&&e.remove(),t.config({doubleClickZoom:this.doubleClickZoom}),this._offMapEvents(),this._chooseLayer.remove(),delete this._task,delete this._chooseLayer,delete this.geometry,delete this.doubleClickZoom,delete this._chooseGeos,delete this._mousemove,delete this._click,delete this._dblclick},r.prototype._updateUpdateSymbol=function(t){this._chooseSymbol=t||this.options.symbol||De.symbol},r.prototype._updateSameType=function(t){t=void 0!==(t=void 0!==t?t:this.options.enableCollection)?t:De.enableCollection,this._enableCollection=t},r.prototype._addTo=function(t){return t.getLayer(this._layerName)&&this.remove(),this.doubleClickZoom=!!t.options.doubleClickZoom,t.config({doubleClickZoom:!1}),this._map=t,this._chooseLayer=new maptalks.VectorLayer(this._layerName).addTo(t),this._chooseLayer.bringToFront(),this._registerMapEvents(),this},r.prototype._registerMapEvents=function(){var e=this;if(!this._mousemove){var t=this._map;this._mousemove=function(t){return e._mousemoveEvents(t)},this._click=function(){return e._clickEvents()},t.on("mousemove",this._mousemove,this),t.on("click",this._click,this)}},r.prototype._offMapEvents=function(){var t=this._map;t.off("mousemove",this._mousemove,this),t.off("click",this._click,this)},r.prototype._mousemoveEvents=function(t){if(!(map._map_tool&&map._map_tool.isEnabled())){var e=this.layer.identify(t.coordinate),o=this._chooseLayer;if(this._needRefreshSymbol){var r=o.getGeometryById("_hit");r&&(r.remove(),delete this.hitGeo),this._needRefreshSymbol=!1}0<e.length&&!this._needRefreshSymbol&&(this._needRefreshSymbol=!0,this.hitGeo=e[0],this._checkIsSameType(this.hitGeo)?this._copyGeoUpdateSymbol(this.hitGeo,this._hitSymbol).setId("_hit"):this.hitGeo=void 0)}},r.prototype._copyGeoUpdateSymbol=function(t,e){var o=this._chooseLayer;switch(t.type){case"MultiPoint":var r={};for(var n in e)n.startsWith("marker")&&(r[n]=e[n]);var i=[];return t._geometries.forEach(function(t){return i.push(t.copy().updateSymbol(r))}),new maptalks.MultiPoint(i).addTo(o);case"MultiPolygon":var a=[];return t._geometries.forEach(function(t){return a.push(t.copy())}),new maptalks.MultiPolygon(a,{symbol:e}).addTo(o);default:return t.copy().updateSymbol(e).addTo(o)}},r.prototype._checkIsSameType=function(t){if(!this._enableCollection){var e=t.type,o=this.geometry.type;if(!e.includes(o)&&!o.includes(e))return!1}return!0},r.prototype._clickEvents=function(){if(!(map._map_tool&&map._map_tool.isEnabled())&&this.hitGeo){var o=this.hitGeo.getCoordinates(),t=this.geometry.getCoordinates();if(Ue(o,t))return null;var r=[];this._chooseGeos.forEach(function(t){var e=t.getCoordinates();Ue(o,e)||r.push(t)}),r.length===this._chooseGeos.length?this._chooseGeos.push(this.hitGeo):this._chooseGeos=r,this._updateChooseGeos()}},r.prototype._updateChooseGeos=function(){var e=this;this._chooseLayer.clear(),this._chooseGeos.forEach(function(t){return e._copyGeoUpdateSymbol(t,e._chooseSymbol)})},r.prototype._submitCombine=function(t){this._chooseGeos.forEach(function(t){return t.remove()});var e=[];this._chooseLayer.getGeometries().forEach(function(t){"_hit"!==t.getId()&&(t.type.startsWith("Multi")?t._geometries.forEach(function(t){return e.push(t.copy())}):e.push(t.copy()))}),t(this._compositMultiGeo(e))},r.prototype._compositMultiGeo=function(t){var e=void 0;switch(t[0].type){case"Point":e=new maptalks.MultiPoint(t);break;case"LineString":e=new maptalks.MultiLineString(t);break;default:e=new maptalks.MultiPolygon(t)}var o=this.geometry.getSymbol(),r=this.geometry.getProperties();return e.setSymbol(o),e.setProperties(r),e},r}(maptalks.Class);Be.mergeOptions(De),t.CDSP=Be,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.cdsp v0.1.0-alpha.1")});