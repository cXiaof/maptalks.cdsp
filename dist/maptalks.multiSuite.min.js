/*!
 * maptalks.multisuite v0.1.0-beta.1
 * LICENSE : MIT
 * (c) 2016-2018 maptalks.org
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.maptalks=t.maptalks||{})}(this,function(t){"use strict";var e=function(){this.__data__=[],this.size=0};var l=function(t,e){return t===e||t!=t&&e!=e};var n=function(t,e){for(var o=t.length;o--;)if(l(t[o][0],e))return o;return-1},r=Array.prototype.splice;var o=function(t){var e=this.__data__,o=n(e,t);return!(o<0||(o==e.length-1?e.pop():r.call(e,o,1),--this.size,0))};var i=function(t){var e=this.__data__,o=n(e,t);return o<0?void 0:e[o][1]};var s=function(t){return-1<n(this.__data__,t)};var a=function(t,e){var o=this.__data__,r=n(o,t);return r<0?(++this.size,o.push([t,e])):o[r][1]=e,this};function c(t){var e=-1,o=null==t?0:t.length;for(this.clear();++e<o;){var r=t[e];this.set(r[0],r[1])}}c.prototype.clear=e,c.prototype.delete=o,c.prototype.get=i,c.prototype.has=s,c.prototype.set=a;var u=c;var f=function(){this.__data__=new u,this.size=0};var h=function(t){var e=this.__data__,o=e.delete(t);return this.size=e.size,o};var p=function(t){return this.__data__.get(t)};var y=function(t){return this.__data__.has(t)},_="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function v(t,e){return t(e={exports:{}},e.exports),e.exports}var m="object"==("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(_)&&_&&_.Object===Object&&_,d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b="object"==("undefined"==typeof self?"undefined":d(self))&&self&&self.Object===Object&&self,g=m||b||Function("return this")(),S=g.Symbol,j=Object.prototype,k=j.hasOwnProperty,w=j.toString,O=S?S.toStringTag:void 0;var G=function(t){var e=k.call(t,O),o=t[O];try{var r=!(t[O]=void 0)}catch(t){}var n=w.call(t);return r&&(e?t[O]=o:delete t[O]),n},P=Object.prototype.toString;var T=function(t){return P.call(t)},C=S?S.toStringTag:void 0;var E=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":C&&C in Object(t)?G(t):T(t)},A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var L=function(t){var e=void 0===t?"undefined":A(t);return null!=t&&("object"==e||"function"==e)};var W,M=function(t){if(!L(t))return!1;var e=E(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},z=g["__core-js_shared__"],x=(W=/[^.]+$/.exec(z&&z.keys&&z.keys.IE_PROTO||""))?"Symbol(src)_1."+W:"";var D=function(t){return!!x&&x in t},F=Function.prototype.toString;var R=function(t){if(null!=t){try{return F.call(t)}catch(t){}try{return t+""}catch(t){}}return""},I=/^\[object .+?Constructor\]$/,N=Function.prototype,H=Object.prototype,U=N.toString,B=H.hasOwnProperty,$=RegExp("^"+U.call(B).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var V=function(t){return!(!L(t)||D(t))&&(M(t)?$:I).test(R(t))};var J=function(t,e){return null==t?void 0:t[e]};var q=function(t,e){var o=J(t,e);return V(o)?o:void 0},X=q(g,"Map"),Y=q(Object,"create");var Z=function(){this.__data__=Y?Y(null):{},this.size=0};var K=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Q=Object.prototype.hasOwnProperty;var tt=function(t){var e=this.__data__;if(Y){var o=e[t];return"__lodash_hash_undefined__"===o?void 0:o}return Q.call(e,t)?e[t]:void 0},et=Object.prototype.hasOwnProperty;var ot=function(t){var e=this.__data__;return Y?void 0!==e[t]:et.call(e,t)};var rt=function(t,e){var o=this.__data__;return this.size+=this.has(t)?0:1,o[t]=Y&&void 0===e?"__lodash_hash_undefined__":e,this};function nt(t){var e=-1,o=null==t?0:t.length;for(this.clear();++e<o;){var r=t[e];this.set(r[0],r[1])}}nt.prototype.clear=Z,nt.prototype.delete=K,nt.prototype.get=tt,nt.prototype.has=ot,nt.prototype.set=rt;var it=nt;var st=function(){this.size=0,this.__data__={hash:new it,map:new(X||u),string:new it}},at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var ct=function(t){var e=void 0===t?"undefined":at(t);return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var ut=function(t,e){var o=t.__data__;return ct(e)?o["string"==typeof e?"string":"hash"]:o.map};var ft=function(t){var e=ut(this,t).delete(t);return this.size-=e?1:0,e};var lt=function(t){return ut(this,t).get(t)};var ht=function(t){return ut(this,t).has(t)};var pt=function(t,e){var o=ut(this,t),r=o.size;return o.set(t,e),this.size+=o.size==r?0:1,this};function yt(t){var e=-1,o=null==t?0:t.length;for(this.clear();++e<o;){var r=t[e];this.set(r[0],r[1])}}yt.prototype.clear=st,yt.prototype.delete=ft,yt.prototype.get=lt,yt.prototype.has=ht,yt.prototype.set=pt;var _t=yt;var vt=function(t,e){var o=this.__data__;if(o instanceof u){var r=o.__data__;if(!X||r.length<199)return r.push([t,e]),this.size=++o.size,this;o=this.__data__=new _t(r)}return o.set(t,e),this.size=o.size,this};function mt(t){var e=this.__data__=new u(t);this.size=e.size}mt.prototype.clear=f,mt.prototype.delete=h,mt.prototype.get=p,mt.prototype.has=y,mt.prototype.set=vt;var dt=mt;var bt=function(t){return this.__data__.has(t)};function gt(t){var e=-1,o=null==t?0:t.length;for(this.__data__=new _t;++e<o;)this.add(t[e])}gt.prototype.add=gt.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},gt.prototype.has=bt;var St=gt;var jt=function(t,e){for(var o=-1,r=null==t?0:t.length;++o<r;)if(e(t[o],o,t))return!0;return!1};var kt=function(t,e){return t.has(e)};var wt=function(t,e,o,r,n,i){var s=1&o,a=t.length,c=e.length;if(a!=c&&!(s&&a<c))return!1;var u=i.get(t);if(u&&i.get(e))return u==e;var f=-1,l=!0,h=2&o?new St:void 0;for(i.set(t,e),i.set(e,t);++f<a;){var p=t[f],y=e[f];if(r)var _=s?r(y,p,f,e,t,i):r(p,y,f,t,e,i);if(void 0!==_){if(_)continue;l=!1;break}if(h){if(!jt(e,function(t,e){if(!kt(h,e)&&(p===t||n(p,t,o,r,i)))return h.push(e)})){l=!1;break}}else if(p!==y&&!n(p,y,o,r,i)){l=!1;break}}return i.delete(t),i.delete(e),l},Ot=g.Uint8Array;var Gt=function(t){var o=-1,r=Array(t.size);return t.forEach(function(t,e){r[++o]=[e,t]}),r};var Pt=function(t){var e=-1,o=Array(t.size);return t.forEach(function(t){o[++e]=t}),o},Tt=S?S.prototype:void 0,Ct=Tt?Tt.valueOf:void 0;var Et=function(t,e,o,r,n,i,s){switch(o){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!i(new Ot(t),new Ot(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return l(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var a=Gt;case"[object Set]":var c=1&r;if(a||(a=Pt),t.size!=e.size&&!c)return!1;var u=s.get(t);if(u)return u==e;r|=2,s.set(t,e);var f=wt(a(t),a(e),r,n,i,s);return s.delete(t),f;case"[object Symbol]":if(Ct)return Ct.call(t)==Ct.call(e)}return!1};var At=function(t,e){for(var o=-1,r=e.length,n=t.length;++o<r;)t[n+o]=e[o];return t},Lt=Array.isArray;var Wt=function(t,e,o){var r=e(t);return Lt(t)?r:At(r,o(t))};var Mt=function(t,e){for(var o=-1,r=null==t?0:t.length,n=0,i=[];++o<r;){var s=t[o];e(s,o,t)&&(i[n++]=s)}return i};var zt=function(){return[]},xt=Object.prototype.propertyIsEnumerable,Dt=Object.getOwnPropertySymbols,Ft=Dt?function(e){return null==e?[]:(e=Object(e),Mt(Dt(e),function(t){return xt.call(e,t)}))}:zt;var Rt=function(t,e){for(var o=-1,r=Array(t);++o<t;)r[o]=e(o);return r},It="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var Nt=function(t){return null!=t&&"object"==(void 0===t?"undefined":It(t))};var Ht=function(t){return Nt(t)&&"[object Arguments]"==E(t)},Ut=Object.prototype,Bt=Ut.hasOwnProperty,$t=Ut.propertyIsEnumerable,Vt=Ht(function(){return arguments}())?Ht:function(t){return Nt(t)&&Bt.call(t,"callee")&&!$t.call(t,"callee")};var Jt=function(){return!1},qt=v(function(t,e){var o=e&&!e.nodeType&&e,r=o&&t&&!t.nodeType&&t,n=r&&r.exports===o?g.Buffer:void 0,i=(n?n.isBuffer:void 0)||Jt;t.exports=i}),Xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yt=/^(?:0|[1-9]\d*)$/;var Zt=function(t,e){var o=void 0===t?"undefined":Xt(t);return!!(e=null==e?9007199254740991:e)&&("number"==o||"symbol"!=o&&Yt.test(t))&&-1<t&&t%1==0&&t<e};var Kt=function(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=9007199254740991},Qt={};Qt["[object Float32Array]"]=Qt["[object Float64Array]"]=Qt["[object Int8Array]"]=Qt["[object Int16Array]"]=Qt["[object Int32Array]"]=Qt["[object Uint8Array]"]=Qt["[object Uint8ClampedArray]"]=Qt["[object Uint16Array]"]=Qt["[object Uint32Array]"]=!0,Qt["[object Arguments]"]=Qt["[object Array]"]=Qt["[object ArrayBuffer]"]=Qt["[object Boolean]"]=Qt["[object DataView]"]=Qt["[object Date]"]=Qt["[object Error]"]=Qt["[object Function]"]=Qt["[object Map]"]=Qt["[object Number]"]=Qt["[object Object]"]=Qt["[object RegExp]"]=Qt["[object Set]"]=Qt["[object String]"]=Qt["[object WeakMap]"]=!1;var te=function(t){return Nt(t)&&Kt(t.length)&&!!Qt[E(t)]};var ee=function(e){return function(t){return e(t)}},oe=v(function(t,e){var o=e&&!e.nodeType&&e,r=o&&t&&!t.nodeType&&t,n=r&&r.exports===o&&m.process,i=function(){try{var t=r&&r.require&&r.require("util").types;return t||n&&n.binding&&n.binding("util")}catch(t){}}();t.exports=i}),re=oe&&oe.isTypedArray,ne=re?ee(re):te,ie=Object.prototype.hasOwnProperty;var se=function(t,e){var o=Lt(t),r=!o&&Vt(t),n=!o&&!r&&qt(t),i=!o&&!r&&!n&&ne(t),s=o||r||n||i,a=s?Rt(t.length,String):[],c=a.length;for(var u in t)!e&&!ie.call(t,u)||s&&("length"==u||n&&("offset"==u||"parent"==u)||i&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Zt(u,c))||a.push(u);return a},ae=Object.prototype;var ce=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||ae)};var ue=function(e,o){return function(t){return e(o(t))}}(Object.keys,Object),fe=Object.prototype.hasOwnProperty;var le=function(t){if(!ce(t))return ue(t);var e=[];for(var o in Object(t))fe.call(t,o)&&"constructor"!=o&&e.push(o);return e};var he=function(t){return null!=t&&Kt(t.length)&&!M(t)};var pe=function(t){return he(t)?se(t):le(t)};var ye=function(t){return Wt(t,pe,Ft)},_e=Object.prototype.hasOwnProperty;var ve=function(t,e,o,r,n,i){var s=1&o,a=ye(t),c=a.length;if(c!=ye(e).length&&!s)return!1;for(var u=c;u--;){var f=a[u];if(!(s?f in e:_e.call(e,f)))return!1}var l=i.get(t);if(l&&i.get(e))return l==e;var h=!0;i.set(t,e),i.set(e,t);for(var p=s;++u<c;){var y=t[f=a[u]],_=e[f];if(r)var v=s?r(_,y,f,e,t,i):r(y,_,f,t,e,i);if(!(void 0===v?y===_||n(y,_,o,r,i):v)){h=!1;break}p||(p="constructor"==f)}if(h&&!p){var m=t.constructor,d=e.constructor;m!=d&&"constructor"in t&&"constructor"in e&&!("function"==typeof m&&m instanceof m&&"function"==typeof d&&d instanceof d)&&(h=!1)}return i.delete(t),i.delete(e),h},me=q(g,"DataView"),de=q(g,"Promise"),be=q(g,"Set"),ge=q(g,"WeakMap"),Se="[object Map]",je="[object Promise]",ke="[object Set]",we="[object WeakMap]",Oe="[object DataView]",Ge=R(me),Pe=R(X),Te=R(de),Ce=R(be),Ee=R(ge),Ae=E;(me&&Ae(new me(new ArrayBuffer(1)))!=Oe||X&&Ae(new X)!=Se||de&&Ae(de.resolve())!=je||be&&Ae(new be)!=ke||ge&&Ae(new ge)!=we)&&(Ae=function(t){var e=E(t),o="[object Object]"==e?t.constructor:void 0,r=o?R(o):"";if(r)switch(r){case Ge:return Oe;case Pe:return Se;case Te:return je;case Ce:return ke;case Ee:return we}return e});var Le=Ae,We="[object Arguments]",Me="[object Array]",ze="[object Object]",xe=Object.prototype.hasOwnProperty;var De=function(t,e,o,r,n,i){var s=Lt(t),a=Lt(e),c=s?Me:Le(t),u=a?Me:Le(e),f=(c=c==We?ze:c)==ze,l=(u=u==We?ze:u)==ze,h=c==u;if(h&&qt(t)){if(!qt(e))return!1;f=!(s=!0)}if(h&&!f)return i||(i=new dt),s||ne(t)?wt(t,e,o,r,n,i):Et(t,e,c,o,r,n,i);if(!(1&o)){var p=f&&xe.call(t,"__wrapped__"),y=l&&xe.call(e,"__wrapped__");if(p||y){var _=p?t.value():t,v=y?e.value():e;return i||(i=new dt),n(_,v,o,r,i)}}return!!h&&(i||(i=new dt),ve(t,e,o,r,n,i))};var Fe=function t(e,o,r,n,i){return e===o||(null==e||null==o||!Nt(e)&&!Nt(o)?e!=e&&o!=o:De(e,o,r,n,t,i))};var Re=function(t,e){return Fe(t,e)},Ie=S?S.isConcatSpreadable:void 0;var Ne=function(t){return Lt(t)||Vt(t)||!!(Ie&&t&&t[Ie])};var He=function t(e,o,r,n,i){var s=-1,a=e.length;for(r||(r=Ne),i||(i=[]);++s<a;){var c=e[s];0<o&&r(c)?1<o?t(c,o-1,r,n,i):At(i,c):n||(i[i.length]=c)}return i};var Ue=function(t){return t};var Be=function(t,e,o){switch(o.length){case 0:return t.call(e);case 1:return t.call(e,o[0]);case 2:return t.call(e,o[0],o[1]);case 3:return t.call(e,o[0],o[1],o[2])}return t.apply(e,o)},$e=Math.max;var Ve=function(i,s,a){return s=$e(void 0===s?i.length-1:s,0),function(){for(var t=arguments,e=-1,o=$e(t.length-s,0),r=Array(o);++e<o;)r[e]=t[s+e];e=-1;for(var n=Array(s+1);++e<s;)n[e]=t[e];return n[s]=a(r),Be(i,this,n)}};var Je=function(t){return function(){return t}},qe=function(){try{var t=q(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),Xe=qe?function(t,e){return qe(t,"toString",{configurable:!0,enumerable:!1,value:Je(e),writable:!0})}:Ue,Ye=Date.now;var Ze=function(o){var r=0,n=0;return function(){var t=Ye(),e=16-(t-n);if(n=t,0<e){if(800<=++r)return arguments[0]}else r=0;return o.apply(void 0,arguments)}}(Xe);var Ke=function(t,e){return Ze(Ve(t,e,Ue),t+"")};var Qe=function(t,e,o,r){for(var n=t.length,i=o+(r?1:-1);r?i--:++i<n;)if(e(t[i],i,t))return i;return-1};var to=function(t){return t!=t};var eo=function(t,e,o){for(var r=o-1,n=t.length;++r<n;)if(t[r]===e)return r;return-1};var oo=function(t,e,o){return e==e?eo(t,e,o):Qe(t,to,o)};var ro=function(t,e){return!(null==t||!t.length)&&-1<oo(t,e,0)};var no=function(t,e,o){for(var r=-1,n=null==t?0:t.length;++r<n;)if(o(e,t[r]))return!0;return!1};var io=function(){},so=be&&1/Pt(new be([,-0]))[1]==1/0?function(t){return new be(t)}:io;var ao=function(t,e,o){var r=-1,n=ro,i=t.length,s=!0,a=[],c=a;if(o)s=!1,n=no;else if(200<=i){var u=e?null:so(t);if(u)return Pt(u);s=!1,n=kt,c=new St}else c=e?[]:a;t:for(;++r<i;){var f=t[r],l=e?e(f):f;if(f=o||0!==f?f:0,s&&l==l){for(var h=c.length;h--;)if(c[h]===l)continue t;e&&c.push(l),a.push(f)}else n(c,l,o)||(c!==a&&c.push(l),a.push(f))}return a};var co=function(t){return Nt(t)&&he(t)};var uo=function(t){var e=null==t?0:t.length;return e?t[e-1]:void 0};Ke(function(t){var e=uo(t);return e="function"==typeof e?e:void 0,ao(He(t,1,co,!0),void 0,e)});function fo(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var o=Object.getOwnPropertyNames(e),r=0;r<o.length;r++){var n=o[r],i=Object.getOwnPropertyDescriptor(e,n);i&&i.configurable&&void 0===t[n]&&Object.defineProperty(t,n,i)}}(t,e))}var lo=function(o){function r(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,o.call(this,t));return e._layerName=maptalks.INTERNAL_LAYER_PREFIX+"_CDSP",e._layerTMP=maptalks.INTERNAL_LAYER_PREFIX+"_CDSP_TMP",e._chooseGeos=[],e._colorHit="#ffa400",e._colorChoose="#00bcd4",e}return fo(r,o),r.prototype.combine=function(t,e){if(t instanceof maptalks.Geometry)return this._initialTaskWithGeo(t,"combine"),e instanceof maptalks.Geometry&&(e=[e]),e instanceof Array&&0<e.length?this._compositWithTargets(e):this._initialChooseGeos(t),this},r.prototype.decompose=function(t,e){if(t instanceof maptalks.GeometryCollection)return this._initialTaskWithGeo(t,"decompose"),e instanceof maptalks.Geometry&&(e=[e]),e instanceof Array&&0<e.length?this._decomposeWithTargets(e):this._initialChooseGeos(t),this},r.prototype.peel=function(t,e){if(t instanceof maptalks.Polygon)return this._initialTaskWithGeo(t,"peel"),e instanceof maptalks.Polygon&&(e=[e]),e instanceof Array&&0<e.length&&(this._peelWithTargets(e),this.remove()),this},r.prototype.fill=function(t,e,o){var r=this;if(t instanceof maptalks.MultiPolygon){if(this._initialTaskWithGeo(t,"fill"),o)this._fillAll(),this.remove();else if(e instanceof maptalks.Polygon&&(e=[e]),e instanceof Array&&0<e.length)this._fillWithTargets(e),this.remove();else{var n=this.geometry.getCoordinates()[0],i=this.geometry.getSymbol();i.polygonOpacity=0,n.forEach(function(t,e){0<e&&new maptalks.Polygon([n[e]],{symbol:i}).addTo(r._tmpLayer)})}return this}},r.prototype.submit=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){return!1};switch(this._task){case"combine":this._submitCombine();break;case"decompose":this._submitDecompose();break;case"peel":this._submitPeel();break;case"fill":this._submitFill()}t(this._result,this._deals),this.remove()},r.prototype.cancel=function(){this.remove()},r.prototype.remove=function(){this._map;this._tmpLayer&&this._tmpLayer.remove(),this._chooseLayer&&this._chooseLayer.remove(),this._chooseGeos=[],this._offMapEvents(),delete this._result,delete this._deals,delete this._task,delete this._tmpLayer,delete this._chooseLayer,delete this._mousemove,delete this._click,delete this._dblclick},r.prototype._initialTaskWithGeo=function(t,e){this._insureSafeTask(),this._task=e,this._savePrivateGeometry(t)},r.prototype._initialChooseGeos=function(t){var e=this;switch(this._task){case"combine":this._chooseGeos=[t];break;case"decompose":t._geometries.forEach(function(t){return t.copy().addTo(e._tmpLayer)}),this._chooseGeos=this._tmpLayer.getGeometries()}this._updateChooseGeos()},r.prototype._insureSafeTask=function(){map._map_tool&&drawTool instanceof maptalks.DrawTool&&drawTool.disable(),this.geometry&&this.remove()},r.prototype._savePrivateGeometry=function(t){this.geometry=t,this.layer=t._layer,t.type.startsWith("Multi")&&(this.layer=t._geometries[0]._layer),this._addTo(this.layer.map)},r.prototype._addTo=function(t){return this._chooseLayer&&this.remove(),this._map=t,this._tmpLayer=new maptalks.VectorLayer(this._layerTMP).addTo(t).bringToFront(),this._chooseLayer=new maptalks.VectorLayer(this._layerName).addTo(t).bringToFront(),this._registerMapEvents(),this},r.prototype._registerMapEvents=function(){var e=this;if(!this._mousemove){var t=this._map;this._mousemove=function(t){return e._mousemoveEvents(t)},this._click=function(t){return e._clickEvents(t)},t.on("mousemove",this._mousemove,this),t.on("click",this._click,this)}},r.prototype._offMapEvents=function(){if(this._mousemove){var t=this._map;t.off("mousemove",this._mousemove,this),t.off("click",this._click,this)}},r.prototype._mousemoveEvents=function(t){var o=this,r=[];switch(this._task){case"combine":r=this.layer.identify(t.coordinate);break;case"decompose":r=this._tmpLayer.identify(t.coordinate);break;case"peel":var n=this._getSafeCoords();this.layer.identify(t.coordinate).forEach(function(t){var e=o._getSafeCoords(t);Re(e,n)||r.push(t)});break;case"fill":r=this._tmpLayer.identify(t.coordinate)}this._updateHitGeo(r,!1)},r.prototype._getSafeCoords=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.geometry,e=t.getCoordinates();if(t.options.numberOfShellPoints){var o=t.options,r=o.numberOfShellPoints;o.numberOfShellPoints=300,t.setOptions(o),e=[t.getShell()],o.numberOfShellPoints=r||60,t.setOptions(o)}return e},r.prototype._updateHitGeo=function(t,e){if(this._needRefreshSymbol){var o=this._chooseLayer.getGeometryById("_hit");o&&(o.remove(),delete this.hitGeo),this._needRefreshSymbol=!1}if(t&&0<t.length)if(this._needRefreshSymbol=!0,this.hitGeo=t[0],this._checkIsSameType(this.hitGeo)||e){var r=this._getSymbolOrDefault(this.hitGeo,"Hit");this._copyGeoUpdateSymbol(this.hitGeo,r).setId("_hit")}else delete this.hitGeo},r.prototype._checkIsSameType=function(t){var e=t.type,o=this.geometry.type;return e.includes(o)||o.includes(e)},r.prototype._getSymbolOrDefault=function(t,e){var o=t.getSymbol(),r=this["_color"+e];if(o){for(var n in o)(n.endsWith("Fill")||n.endsWith("Color"))&&(o[n]=r);o.lineWidth=4}else o=t.type.endsWith("Point")?{markerFill:r,markerType:"path",markerPath:[{path:"M8 23l0 0 0 0 0 0 0 0 0 0c-4,-5 -8,-10 -8,-14 0,-5 4,-9 8,-9l0 0 0 0c4,0 8,4 8,9 0,4 -4,9 -8,14z M3,9 a5,5 0,1,0,0,-0.9Z",fill:"#DE3333"}],markerPathWidth:16,markerPathHeight:23,markerWidth:24,markerHeight:34}:{lineColor:r,lineWidth:4};return o},r.prototype._copyGeoUpdateSymbol=function(t,e){return t.copy().updateSymbol(e).addTo(this._chooseLayer)},r.prototype._clickEvents=function(t){switch(this._task){case"combine":this._clickCombine();break;case"decompose":this._clickDecompose(t);break;default:if(this.hitGeo){var e=this._getSafeCoords(this.hitGeo);this._setChooseGeosExceptHit(e),this._updateChooseGeos()}}},r.prototype._clickCombine=function(){if(this.hitGeo){var t=this._getSafeCoords(this.hitGeo),e=this._getSafeCoords();if(Re(t,e))return null;this._setChooseGeosExceptHit(t),this._updateChooseGeos()}},r.prototype._setChooseGeosExceptHit=function(o,t){var r=this,n=[];this._chooseGeos.forEach(function(t){var e=r._getSafeCoords(t);Re(o,e)||n.push(t)}),t||n.length!==this._chooseGeos.length?this._chooseGeos=n:this._chooseGeos.push(this.hitGeo)},r.prototype._updateChooseGeos=function(){var o=this;this._chooseLayer.clear(),this._chooseGeos.forEach(function(t){var e=o._getSymbolOrDefault(t,"Choose");o._copyGeoUpdateSymbol(t,e)})},r.prototype._clickDecompose=function(t){var e=[];if(this._chooseLayer.identify(t.coordinate).forEach(function(t){"_hit"!==t.getId()&&e.push(t)}),0<e.length){var o=e[0],r=this._getSafeCoords(o);this._setChooseGeosExceptHit(r,!0),o.remove()}else this.hitGeo&&this._chooseGeos.push(this.hitGeo);this._updateChooseGeos()},r.prototype._submitCombine=function(){this._compositWithTargets()},r.prototype._compositWithTargets=function(){var o=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._chooseGeos;this._deals=[],t.forEach(function(t){return o._deals.push(t.copy())});var r=this._getGeoStringifyCoords(t),n=[];this.layer.getGeometries().forEach(function(t){var e=o._getGeoStringifyCoords(t);r.includes(e)&&(t.type.startsWith("Multi")?t._geometries.forEach(function(t){return n.push(t.copy())}):n.push(t.copy()),t.remove())}),this._compositResultGeo(n)},r.prototype._getGeoStringifyCoords=function(t){var e=this;if(t instanceof Array){var o=[];return t.forEach(function(t){return o.push(JSON.stringify(e._getSafeCoords(t)))}),o}return JSON.stringify(this._getSafeCoords(t))},r.prototype._compositResultGeo=function(t){var e=t.length;if(!e||0===e)return null;var o=void 0;switch(t[0].type){case"Point":o=new maptalks.MultiPoint(t);break;case"LineString":o=new maptalks.MultiLineString(t);break;default:o=new maptalks.MultiPolygon(t)}o.setSymbol(this.geometry.getSymbol()),o.setProperties(this.geometry.getProperties()),o.addTo(this.layer),this._result=o},r.prototype._submitDecompose=function(){this._decomposeWithTargets()},r.prototype._decomposeWithTargets=function(){var o=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._chooseLayer.getGeometries(),r=[];t.forEach(function(t){"_hit"!==t.getId()&&r.push(o._getGeoStringifyCoords(t))});var n=[];this._deals=[],this._tmpLayer.getGeometries().forEach(function(t){var e=o._getGeoStringifyCoords(t);r.includes(e)?n.push(t.copy()):(t=t.copy().addTo(o.layer),o._deals.push(t))}),this.geometry.remove(),this._compositResultGeo(n)},r.prototype._peelWithTargets=function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._chooseGeos,o=this.geometry,r=[this._getSafeCoords(o)[0]];this._deals=[],t.forEach(function(t){t instanceof maptalks.MultiPolygon?t._geometries.forEach(function(t){return r.push(e._getSafeCoords(t)[0])}):r.push(e._getSafeCoords(t)[0]),e._deals.push(t.copy()),t.remove()}),this._result=new maptalks.MultiPolygon([r],{symbol:o.getSymbol(),properties:o.getProperties()}).addTo(o._layer),o.remove()},r.prototype._submitPeel=function(){this._peelWithTargets()},r.prototype._submitFill=function(){this._fillWithTargets()},r.prototype._fillAll=function(){var t=this.geometry.getCoordinates(),e=this.geometry.getSymbol(),o=this.geometry.getProperties();new maptalks.Polygon([t[0][0]],{symbol:e,properties:o}).addTo(this.layer),this.geometry.remove()},r.prototype._fillWithTargets=function(){var o=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._chooseGeos,r=this.geometry.getSymbol(),e=this.geometry.getProperties(),n=[];this._deals=[],t.forEach(function(t){var e=JSON.stringify(t.getCoordinates()[0]);n.push(e),o._deals.push(t.setSymbol(r).copy())});var i=[];this.geometry.getCoordinates()[0].forEach(function(t){n.includes(JSON.stringify(t))||i.push(t)}),this._result=new maptalks.MultiPolygon([i],{symbol:r,properties:e}).addTo(this.layer),this.geometry.remove()},r}(maptalks.Class);lo.mergeOptions({}),t.MultiSuite=lo,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.multisuite v0.1.0-beta.1")});